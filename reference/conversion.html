<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Converting between R and Python MS data structures — conversion • SpectriPy</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Converting between R and Python MS data structures — conversion"><meta name="description" content="The rspec_to_pyspec() and pyspec_to_rspec() functions allow to convert
(translate) MS data structures between R and Python. At present the
R Spectra::Spectra() objects can be either translated into a list of
matchms Python matchms.Spectrum
objects or
spectrum_utils Python
spectrum_utils.spectrum.MsmsSpectrum objects.
For better integration with the reticulate R package also a
r_to_py.Spectra() method is available.
The mapping of spectra variables (in R) to (Python) spectra metadata can
be configured and defined with the setSpectraVariableMapping() and
spectraVariableMapping(). These get and set the global (system wide)
setting and are thus also used by the r_to_py() method.
Properties for translation to the MS data objects of the different Python
libraries are:
matchms: the matchms.Spectrum objects support arbitrary metadata, so
any spectra variable can be translated and stored in these objects.
spectrum_utils: the spectrum_utils.spectrum.MsmsSpectrum object
supports metadata variables identifier (character), precursor_mz
(numeric), precursor_charge (integer) and optionally also
retention_time (numeric).


See the indivudual function's documentation for more details.
Function to convert R Spectra objects into a Python list of matchms Spectrum
objects using the reticulate package."><meta property="og:description" content="The rspec_to_pyspec() and pyspec_to_rspec() functions allow to convert
(translate) MS data structures between R and Python. At present the
R Spectra::Spectra() objects can be either translated into a list of
matchms Python matchms.Spectrum
objects or
spectrum_utils Python
spectrum_utils.spectrum.MsmsSpectrum objects.
For better integration with the reticulate R package also a
r_to_py.Spectra() method is available.
The mapping of spectra variables (in R) to (Python) spectra metadata can
be configured and defined with the setSpectraVariableMapping() and
spectraVariableMapping(). These get and set the global (system wide)
setting and are thus also used by the r_to_py() method.
Properties for translation to the MS data objects of the different Python
libraries are:
matchms: the matchms.Spectrum objects support arbitrary metadata, so
any spectra variable can be translated and stored in these objects.
spectrum_utils: the spectrum_utils.spectrum.MsmsSpectrum object
supports metadata variables identifier (character), precursor_mz
(numeric), precursor_charge (integer) and optionally also
retention_time (numeric).


See the indivudual function's documentation for more details.
Function to convert R Spectra objects into a Python list of matchms Spectrum
objects using the reticulate package."><meta property="og:image" content="https://rformassspectrometry.github.io/SpectriPy/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SpectriPy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/SpectriPy.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/detailed-installation-configuration.html">Detailed information on installation and configuration</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RforMassSpectrometry/SpectriPy/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Converting between R and Python MS data structures</h1>
      <small class="dont-index">Source: <a href="https://github.com/RforMassSpectrometry/SpectriPy/blob/main/R/conversion.R" class="external-link"><code>R/conversion.R</code></a></small>
      <div class="d-none name"><code>conversion.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>rspec_to_pyspec()</code> and <code>pyspec_to_rspec()</code> functions allow to convert
(translate) MS data structures between R and Python. At present the
R <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> objects can be either translated into a list of
<a href="https://github.com/matchms/matchms" class="external-link">matchms</a> Python <code>matchms.Spectrum</code>
objects or
<a href="https://github.com/bittremieux-lab/spectrum_utils" class="external-link">spectrum_utils</a> Python
<code>spectrum_utils.spectrum.MsmsSpectrum</code> objects.
For better integration with the <em>reticulate</em> R package also a
<code>r_to_py.Spectra()</code> method is available.</p>
<p>The mapping of spectra variables (in R) to (Python) spectra metadata can
be configured and defined with the <code>setSpectraVariableMapping()</code> and
<code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code>. These get and set the <em>global</em> (system wide)
setting and are thus also used by the <code><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py()</a></code> method.</p>
<p>Properties for translation to the MS data objects of the different Python
libraries are:</p><ul><li><p><em>matchms</em>: the <code>matchms.Spectrum</code> objects support arbitrary metadata, so
any spectra variable can be translated and stored in these objects.</p></li>
<li><p><em>spectrum_utils</em>: the <code>spectrum_utils.spectrum.MsmsSpectrum</code> object
supports metadata variables <em>identifier</em> (<code>character</code>), <em>precursor_mz</em>
(<code>numeric</code>), <em>precursor_charge</em> (<code>integer</code>) and optionally also
<em>retention_time</em> (<code>numeric</code>).</p></li>
</ul><p>See the indivudual function's documentation for more details.</p>
<p>Function to convert R Spectra objects into a Python list of matchms Spectrum
objects using the <code>reticulate</code> package.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S4 method for class 'character'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for class 'missing'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">setSpectraVariableMapping</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">defaultSpectraVariableMapping</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'Spectra'</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py</a></span><span class="op">(</span><span class="va">x</span>, convert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rspec_to_pyspec</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  pythonLibrary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"matchms"</span>, <span class="st">"spectrum_utils"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pyspec_to_rspec</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  pythonLibrary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"matchms"</span>, <span class="st">"spectrum_utils"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>For <code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code>: not used.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>For <code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code>: not used.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code>Spectra</code> object.</p></dd>


<dt id="arg-convert">convert<a class="anchor" aria-label="anchor" href="#arg-convert"></a></dt>
<dd><p>Boolean; should Python objects be automatically converted to
their R equivalent? Defaults to <code>FALSE</code>.</p></dd>


<dt id="arg-mapping">mapping<a class="anchor" aria-label="anchor" href="#arg-mapping"></a></dt>
<dd><p>named <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character()</a></code> vector defining which spectra
variables/metadata should be translated between R and Python and how
they should be renamed. Defaults to <code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code>.</p></dd>


<dt id="arg-pythonlibrary">pythonLibrary<a class="anchor" aria-label="anchor" href="#arg-pythonlibrary"></a></dt>
<dd><p>For <code>rspec_to_pyspec()</code> and <code>pyspec_to_rspec()</code>:
<code>character(1)</code> defining the Python library to which (or from which)
data structures the data should be converted.
Possible options are <code>"matchms"</code> or <code>"spectrum_utils"</code> with <code>"matchms"</code>
being the default.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For <code>r_to_py.Spectra()</code> and <code>rspec_to_pyspec()</code>: Python list of
MS data structures, either <code>matchms.Spectrum</code> or
<code>spectrum_utils.spectrum.MsmsSpectrum</code> objects. For <code>pyspec_to_rspec()</code>:
<code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> with the MS data of all <code>matchms.Spectrum</code> objects
in the submitted <code>list</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="translation-of-ms-data-objects">Translation of MS data objects<a class="anchor" aria-label="anchor" href="#translation-of-ms-data-objects"></a></h2>



<p>MS data structures can be translated between R and Python using the
<code>rspec_to_pyspec()</code> and <code>pyspec_to_rspec()</code> functions, or with the
<code><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py()</a></code> method.</p><ul><li><p><code>rspec_to_pyspec()</code> translates an R <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> object into a
list of Python MS data objects, which can be, depending on parameter
<code>pythonLibrary</code>, <code>matchms.Spectrum</code> objects (for
<code>pythonLibrary = "matchms"</code>, the default) or
<code>spectrum_utils.spectrum.MsmsSpectrum</code> objects (for
<code>pythonLibrary = "spectrum_utils"</code>). Parameter <code>mapping</code> allows to specify
which spectra variables from the <code>Spectra</code> object <code>x</code> should be converted
in addition to the peaks data (m/z and intensity values). It defaults to
<code>mapping = spectraVariableMapping()</code> (See the respective help below for
more information on the variable mapping). While being fast, this function
first loads all peaks and spectra data into memory before translating to
Python data structures. A less memory intense operation could be to call
this function in a loop to only load parts of the data at a time into
memory.</p></li>
<li><p><code>pyspec_to_rspec()</code> translates a single, or a list of <code>matchms.Spectrum</code>
objects (with parameter <code>pythonLibrary = "matchms"</code>, the default) or a
list of <code>spectrum_utils.spectrum.MsmsSpectrum</code> objects (with parameter
<code>pythonLibrary = "spectrum_utils"</code>) to a <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> object.
Parameter <code>mapping</code> allows to specify the metadata variables that
should be translated and mapped in addition to the peaks data. The
library used to represent the MS data in Python needs to be specified with
parameter <code>pythonLibrary</code>.</p></li>
<li><p><code>r_to_py.Spectra()</code> is equivalent to
<code>rspec_to_pyspec(pythonLibrary = "matchms")</code>. The spectra
variables that should be converted can be configures with
<code>setSpectraVariableMapping()</code> (see documentation below).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="mapping-of-spectra-variables-metadata-">Mapping of spectra variables (metadata)<a class="anchor" aria-label="anchor" href="#mapping-of-spectra-variables-metadata-"></a></h2>



<p>Metadata for MS spectra are represented and stored as <em>spectra variables</em>
in the R <code><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra::Spectra()</a></code> objects. Also Python MS data structures
store such metadata along with the mass peak data. While spectra metadata
is thus supported by data structures in both programming languages,
different names and naming conventions are used. The
<code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code> and <code>setSpectraVariableMapping()</code> functions allow
to define how the names of spectra metadata (spectra variables) should be
translated between R and Python. To support also the different naming
conventions used by the Python libraries <em>matchms</em> and <em>spectrum_utils</em>,
<code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code> defines different mapping schemes for these,
using by default the mapping for <em>matchms</em>. Note also that <em>spectrum_utils</em>
supports only few selected metadata/spectra variables, so any additional
spectra variables defined by the mapping will be ignored.
The <code><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py()</a></code> and <code><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">py_to_r()</a></code> functions will use the selected naming
scheme to name the spectra variables accordingly. Also, only
spectra metadata/variables in <code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code> will be translated.
The initial mapping is based on this
<a href="https://github.com/matchms/matchms/blob/master/matchms/data/known_key_conversions.csv" class="external-link">definition in matchms</a>.</p><ul><li><p><code>defaultSpectraVariableMapping()</code>: returns the <em>default</em> mapping between
spectra variables and Python metadata names for the <em>matchms</em> library.</p></li>
<li><p><code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code>: returns the currently defined spectra
variable mapping as a named character vector, with names representing the
names of the spectra variables in R and elements the respective names
of the spectra metadata in Python. Use <code><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">Spectra::spectraVariables()</a></code> on
the <code>Spectra</code> object that should be converted with <code><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py()</a></code> to list
all available spectra variables. <code><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py()</a></code> and <code><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">py_to_r()</a></code> for MS data
structures will use this default mapping. Calling
<code><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping()</a></code> defining also the Python library (e.g.,
<code>spectraVariableMapping("matchms")</code> or
<code>spectraVariableMapping("spectrum_utils")</code>) will return the variable
mapping for the specified Python library.</p></li>
<li><p><code>setSpectraVariableMapping()</code>: sets/replaces the currently defined mapping
of spectra variable names to Python metadata names. Setting
<code>setSpectraVariableMapping(character())</code> will only convert the mass peaks
data (m/z and intensity values) but no spectra metadata.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Michael Witting, Johannes Rainer, Wout Bittremieux, Thomas Naake</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Import a MGF file as a `Spectra` object</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsBackendMgf" class="external-link">MsBackendMgf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/SpectriPy" class="external-link">SpectriPy</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/Spectra.html" class="external-link">Spectra</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mgf"</span>, <span class="st">"spectra2.mgf"</span>, package <span class="op">=</span> <span class="st">"SpectriPy"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsBackendMgf/man/MsBackendMgf.html" class="external-link">MsBackendMgf</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Start data import from 1 files ... </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> done</span>
<span class="r-in"><span><span class="va">s</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 4 spectra in a MsBackendMgf backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         2   2678.94        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2   2373.51        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         2   2511.03        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         2        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 17 more variables/columns.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#########################</span></span></span>
<span class="r-in"><span><span class="co">## Conversion R to Python</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## A `Spectra` can be translated to a `list` of `matchms.Spectrum` objects</span></span></span>
<span class="r-in"><span><span class="co">## using either the `r_to_py()` method or the `rspec_to_pyspec()` function:</span></span></span>
<span class="r-in"><span><span class="va">s_py</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s_py</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [Spectrum(precursor m/z=718.36, 203 fragments between 101.1 and 1272.7), Spectrum(precursor m/z=507.75, 755 fragments between 130.2 and 1020.5), Spectrum(precursor m/z=507.74, 85 fragments between 110.1 and 998.4), Spectrum(precursor m/z=633.27, 431 fragments between 51.0 and 753.4)]</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The `s_py` can now be used like any other Python variable within the R</span></span></span>
<span class="r-in"><span><span class="co">## *reticulate* framework. Below we extract the m/z values of the first</span></span></span>
<span class="r-in"><span><span class="co">## spectrum</span></span></span>
<span class="r-in"><span><span class="va">s_py</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">mz</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> array([ 101.07122,  109.68925,  115.86999,  120.0811 ,  129.06595,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         129.1023 ,  130.06534,  130.08633,  130.95578,  131.11859,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         132.07968,  136.07567,  141.31848,  142.21034,  147.11273,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         155.08185,  159.07605,  159.09169,  160.07516,  160.09506,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         170.06009,  171.06319,  175.11871,  186.12335,  187.08667,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         197.12814,  199.10913,  199.17963,  200.10286,  201.10281,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         201.12341,  204.11336,  204.13414,  211.14496,  213.15979,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         214.09769,  214.1535 ,  215.10004,  216.64253,  217.13332,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         224.13977,  225.12349,  226.08267,  228.13486,  229.1201 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         233.16495,  239.08228,  242.14993,  243.10875,  244.10834,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         245.35168,  253.09628,  256.10834,  261.1596 ,  273.13486,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         282.17978,  284.10266,  285.10632,  287.17343,  289.11084,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         301.129  ,  302.1327 ,  305.1811 ,  310.1727 ,  313.18762,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         318.15506,  321.1563 ,  326.17813,  328.2328 ,  334.15466,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         344.00247,  344.19284,  345.1581 ,  347.17093,  352.19876,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         353.1817 ,  356.1928 ,  361.2311 ,  362.20374,  363.207  ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         367.14435,  370.21045,  384.16763,  385.17123,  395.1348 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         402.18094,  409.20935,  412.16074,  413.16446,  417.17773,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         424.21753,  425.2271 ,  429.1876 ,  430.19342,  441.24667,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         454.23114,  462.21368,  463.1971 ,  480.2241 ,  481.22632,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         484.24506,  488.21954,  497.25027,  498.25397,  506.25055,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         508.22073,  512.25824,  516.2635 ,  517.2272 ,  521.2413 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         523.74426,  525.2426 ,  526.2479 ,  530.26794,  538.2638 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         542.2722 ,  545.24817,  548.2805 ,  549.2873 ,  550.7827 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         555.2859 ,  559.2943 ,  559.7948 ,  571.2866 ,  587.2942 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         599.28723,  599.7854 ,  600.4091 ,  608.29016,  629.78845,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         636.28156,  639.34784,  646.328  ,  647.32837,  653.3023 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         670.3162 ,  677.3326 ,  685.323  ,  692.32416,  695.3513 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         696.3513 ,  702.3403 ,  703.35065,  707.32135,  709.8466 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         710.34625,  717.88837,  718.3871 ,  718.88586,  724.3413 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         729.36005,  730.32825,  748.37524,  757.3715 ,  763.14374,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         766.2276 ,  766.38745,  767.39105,  767.7366 ,  783.813  ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         831.4068 ,  835.4187 ,  858.4285 ,  859.41895,  869.44836,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         871.4104 ,  876.4352 ,  877.4197 ,  878.41345,  886.42194,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         887.41785,  894.44464,  895.44763,  904.4519 ,  905.4429 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         906.4541 ,  972.48206,  989.50586,  990.4984 , 1007.53156,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1008.5328 , 1017.5188 , 1018.51953, 1037.5978 , 1046.4642 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1082.4929 , 1100.5747 , 1117.5706 , 1118.574  , 1119.5591 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1135.5819 , 1136.5898 , 1145.5717 , 1214.5857 , 1215.5576 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1227.598  , 1232.5897 , 1233.6329 , 1249.6306 , 1250.6298 ,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1260.6073 , 1261.614  , 1272.6572 ])</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Extracting that information from the `Spectra` object in R</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="va">mz</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NumericList of length 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]] 101.07122 109.68925 115.86999 120.0811 ... 1260.6073 1261.614 1272.6572</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The `spectraVariableMapping()` defines which spectra variables (metadata)</span></span></span>
<span class="r-in"><span><span class="co">## should be translated between R and Python:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  precursorMz           precursorIntensity </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               "precursor_mz"        "precursor_intensity" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              precursorCharge                        rtime </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     "charge"             "retention_time" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              collisionEnergy      isolationWindowTargetMz </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           "collision_energy" "isolation_window_target_mz" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      msLevel </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "ms_level" </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The names of that character vector represent the names of the spectra</span></span></span>
<span class="r-in"><span><span class="co">## variables in R, the elements the name of the metadata variable in Python.</span></span></span>
<span class="r-in"><span><span class="co">## Below we list the available metadata information from the first</span></span></span>
<span class="r-in"><span><span class="co">## Spectrum in Python</span></span></span>
<span class="r-in"><span><span class="va">s_py</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {'precursor_mz': 718.36, 'precursor_intensity': nan, 'charge': 2, 'retention_time': 2678.94, 'collision_energy': nan, 'isolation_window_target_mz': nan, 'ms_level': 2}</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## `setSpectraVariableMapping()` allows to replace the default mapping</span></span></span>
<span class="r-in"><span><span class="co">## of variables. Below we e.g. add a new spectra variable to the `Spectra`</span></span></span>
<span class="r-in"><span><span class="co">## object.</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">$</span><span class="va">new_col</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## To translate that variable to Python we need to include it to the</span></span></span>
<span class="r-in"><span><span class="co">## `spectraVariableMapping()`. Below we define to translate only the</span></span></span>
<span class="r-in"><span><span class="co">## precursor m/z and the new spectra variable to Python. Be aware that</span></span></span>
<span class="r-in"><span><span class="co">## `setSpectraVariableMapping()` **globally** sets the default for any</span></span></span>
<span class="r-in"><span><span class="co">## spectra variable mapping between R and Python. Thus, any subsequent</span></span></span>
<span class="r-in"><span><span class="co">## calls mapping calls will use the same mapping. It is suggested to</span></span></span>
<span class="r-in"><span><span class="co">## eventually *restore* the default mapping again after the call or</span></span></span>
<span class="r-in"><span><span class="co">## use the `rspec_to_pyspec()` function instead, that allows to configure</span></span></span>
<span class="r-in"><span><span class="co">## the mapping using a parameter `mapping`.</span></span></span>
<span class="r-in"><span><span class="fu">setSpectraVariableMapping</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>precursorMz <span class="op">=</span> <span class="st">"precursor_mz"</span>, new_col <span class="op">=</span> <span class="st">"new_col"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">s_py</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/r-py-conversion.html" class="external-link">r_to_py</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">s_py</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span><span class="op">$</span><span class="va">metadata</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {'precursor_mz': 718.36, 'new_col': 1}</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Restoring the global spectra variable mapping configuration to</span></span></span>
<span class="r-in"><span><span class="co">## the default mapping:</span></span></span>
<span class="r-in"><span><span class="fu">setSpectraVariableMapping</span><span class="op">(</span><span class="fu">defaultSpectraVariableMapping</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## As an alternative to the `r_to_py()` we can use the `rspec_to_pyspec()`</span></span></span>
<span class="r-in"><span><span class="co">## function and provide a custom mapping using the `mapping` parameter:</span></span></span>
<span class="r-in"><span><span class="va">s_py</span> <span class="op">&lt;-</span> <span class="fu">rspec_to_pyspec</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">s</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>precursorMz <span class="op">=</span> <span class="st">"precursor_mz"</span>, new_col <span class="op">=</span> <span class="st">"new_col"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Convert to MS data objects from the spectrum_utils Python library</span></span></span>
<span class="r-in"><span><span class="va">s_py2</span> <span class="op">&lt;-</span> <span class="fu">rspec_to_pyspec</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">s</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Spectra/man/spectraVariableMapping.html" class="external-link">spectraVariableMapping</a></span><span class="op">(</span><span class="st">"spectrum_utils"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    pythonLibrary <span class="op">=</span> <span class="st">"spectrum_utils"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Convert the data back to R</span></span></span>
<span class="r-in"><span><span class="fu">pyspec_to_rspec</span><span class="op">(</span><span class="va">s_py2</span>, pythonLibrary <span class="op">=</span> <span class="st">"spectrum_utils"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 4 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        NA   2678.94        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        NA   2373.51        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        NA   2511.03        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        NA        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 16 more variables/columns.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#########################</span></span></span>
<span class="r-in"><span><span class="co">## Conversion Python to R</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## A `list` of `matchms.Spectrum` objects in Python can be translated into</span></span></span>
<span class="r-in"><span><span class="co">## the corresponding MS data structure in R (i.e. a `Spectra`) object using</span></span></span>
<span class="r-in"><span><span class="co">## the `pyspec_to_rspec()` function:</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">pyspec_to_rspec</span><span class="op">(</span><span class="va">s_py</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> MSn data (Spectra) with 4 spectra in a MsBackendMemory backend:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     msLevel     rtime scanIndex</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   &lt;integer&gt; &lt;numeric&gt; &lt;integer&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        NA        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        NA        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        NA        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        NA        NA        NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ... 16 more variables/columns.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## All spectra from Python are thus converted into a single `Spectra` object.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Or providing a custom variable mapping:</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">pyspec_to_rspec</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">s_py</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>precursorMz <span class="op">=</span> <span class="st">"precursor_mz"</span>, new_col <span class="op">=</span> <span class="st">"new_col"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">new_col</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 3 4</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Witting, Johannes Rainer, Carolin Huber, Marilyn De Graeve, Wout Bittremieux, Thomas Naake.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer></div>





  </body></html>

